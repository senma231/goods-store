# 商品发货方式和库存管理指南

## 📋 概述

系统支持两种发货方式和两种库存类型，可以灵活配置商品的发货和库存管理策略。

---

## 🚀 发货方式

### 1. **自动发货** (推荐)

**适用场景**：
- 虚拟商品（激活码、卡密、账号等）
- 有固定库存的商品
- 需要即时交付的商品

**工作流程**：
1. 用户完成支付
2. 系统自动从"库存管理"中分配可用资产
3. 通过邮件发送给用户
4. 订单状态自动更新为"已完成"

**配置要求**：
- 必须在"库存管理"中添加虚拟资产
- 库存类型建议设置为"有限库存"

### 2. **手动发货**

**适用场景**：
- 需要人工审核的商品
- 定制化服务
- 特殊商品

**工作流程**：
1. 用户完成支付
2. 订单状态为"待处理"
3. 管理员在后台手动发货
4. 订单状态更新为"已完成"

**配置要求**：
- 无需配置库存管理
- 可以设置为"无限库存"或"有限库存"

---

## 📦 库存类型

### 1. **无限库存**

**特点**：
- 前端显示为 <span style="color: green; font-weight: bold;">9999+</span>
- 不限制购买数量
- 不关联库存管理

**适用场景**：
- 虚拟服务（不受数量限制）
- 手动发货商品
- 可以无限生成的商品

**前端显示**：
```
库存状态: 9999+ 件
```

### 2. **有限库存**

**特点**：
- 显示真实库存数量
- 关联库存管理中的可用资产
- 库存不足时无法购买

**适用场景**：
- 有固定数量的虚拟商品
- 自动发货商品
- 需要控制销量的商品

**前端显示**：
```
库存状态: 50 件        (库存充足，黑色)
库存状态: 5 件         (库存不足，红色警告)
```

**库存计算规则**：
- **自动发货商品**：库存 = 库存管理中的可用资产数量
- **手动发货商品**：库存 = 手动设置的数量

---

## 🔧 配置步骤

### 步骤 1: 运行数据库迁移

在服务器上运行迁移脚本，添加新字段：

```bash
cd /var/www/goods-store/backend
node src/database/migrations/add-product-delivery-fields.js
```

### 步骤 2: 配置商品

1. 登录管理后台
2. 进入"商品管理"
3. 点击"新增商品"或编辑现有商品
4. 配置以下选项：

#### 发货方式
- **自动发货**：支付成功后自动从库存管理分配虚拟资产
- **手动发货**：需要管理员手动发货

#### 库存类型
- **无限库存**：前端显示为"9999+"，不限制购买数量
- **有限库存**：库存数量关联库存管理中的真实库存

### 步骤 3: 添加库存（仅自动发货商品）

如果选择"自动发货"，需要在"库存管理"中添加虚拟资产：

1. 进入"库存管理"标签
2. 选择商品
3. 批量导入或单个添加虚拟资产
4. 系统会自动计算可用库存

---

## 💡 推荐配置方案

### 方案 1: 虚拟激活码（推荐）

```
发货方式: 自动发货
库存类型: 有限库存
库存管理: 批量导入激活码
```

**优点**：
- ✅ 完全自动化
- ✅ 即时交付
- ✅ 库存实时更新

### 方案 2: 虚拟服务

```
发货方式: 手动发货
库存类型: 无限库存
库存管理: 无需配置
```

**优点**：
- ✅ 灵活处理
- ✅ 无库存限制
- ✅ 适合定制服务

### 方案 3: 限量商品

```
发货方式: 自动发货
库存类型: 有限库存
库存管理: 添加固定数量的资产
```

**优点**：
- ✅ 控制销量
- ✅ 自动发货
- ✅ 库存预警

---

## 📊 库存显示规则

| 库存类型 | 管理后台显示 | 前端显示 | 颜色 |
|---------|------------|---------|------|
| 无限库存 | 9999+ | 9999+ 件 | 绿色 |
| 有限库存 (≥10) | 实际数量 | X 件 | 黑色 |
| 有限库存 (<10) | 实际数量 | X 件 | 红色 |

---

## ⚠️ 注意事项

### 1. **自动发货商品必须配置库存**

如果选择"自动发货"但没有在库存管理中添加资产，用户支付后无法自动发货。

### 2. **库存不足警告**

当有限库存商品的可用库存低于10时：
- 管理后台会显示红色警告
- 仪表盘会显示库存预警
- 建议及时补充库存

### 3. **手动发货流程**

手动发货商品需要管理员在"订单管理"中：
1. 找到待发货订单
2. 点击"手动发货"按钮
3. 填写发货内容
4. 确认发货

---

## 🔄 迁移现有商品

如果您已经有商品，迁移脚本会：
1. 自动添加新字段
2. 默认设置为"自动发货"
3. 将现有 `stock_quantity` 同步到 `total_stock` 和 `available_stock`

建议迁移后检查每个商品的配置，确保符合实际需求。

---

## 📚 相关文档

- [虚拟商品自动发货系统使用指南](../backend/AUTO_DELIVERY_GUIDE.md)
- [库存管理指南](./inventory-management-guide.md)

---

**配置完成后，您的商城将支持灵活的发货方式和库存管理！**

