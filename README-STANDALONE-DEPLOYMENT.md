# è™šæ‹Ÿå•†å“å•†åŸ - ç‹¬ç«‹æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å·²ä» Supabase + Cloudflare æ¶æ„è¿ç§»åˆ°**å®Œå…¨ç‹¬ç«‹çš„æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ**ã€‚

### âœ… å·²å®Œæˆçš„å·¥ä½œ

1. **æ¸…ç† Cloudflare ç›¸å…³ä»£ç ** - `cloudflare-migration/` ç›®å½•ä¿ç•™ä½œä¸ºå‚è€ƒï¼Œä¸å†ä½¿ç”¨
2. **åˆ›å»ºç‹¬ç«‹åç«¯ API** - åŸºäº Express.js + SQLite
3. **ä¿®æ”¹å‰ç«¯ API è°ƒç”¨** - ä» Supabase æ”¹ä¸ºç‹¬ç«‹åç«¯
4. **æ•°æ®åº“è¿ç§»** - ä» PostgreSQL (Supabase) æ”¹ä¸º SQLite

---

## ğŸ—ï¸ æ–°æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (React + TypeScript + Vite)        â”‚
â”‚  ç«¯å£: 5173                              â”‚
â”‚  ç›®å½•: virtual-goods-store/              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ HTTP API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯ (Express.js + SQLite)              â”‚
â”‚  ç«¯å£: 8787                              â”‚
â”‚  ç›®å½•: backend/                          â”‚
â”‚  - JWT è®¤è¯                              â”‚
â”‚  - Stripe + USDT æ”¯ä»˜                    â”‚
â”‚  - å•†å“ã€è®¢å•ã€è´­ç‰©è½¦ç®¡ç†                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQLite æ•°æ®åº“                           â”‚
â”‚  æ–‡ä»¶: backend/data/database.db          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ æœ¬åœ°å¯åŠ¨æ­¥éª¤

### 1. å¯åŠ¨åç«¯

```bash
cd backend
npm install
npm run init-db  # åˆå§‹åŒ–æ•°æ®åº“
npm start        # å¯åŠ¨åç«¯æœåŠ¡å™¨
```

åç«¯å°†è¿è¡Œåœ¨ `http://localhost:8787`

**é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š**
- é‚®ç®±: `admin@shop.com`
- å¯†ç : `admin123`

### 2. å¯åŠ¨å‰ç«¯

```bash
cd virtual-goods-store
pnpm install
pnpm dev
```

å‰ç«¯å°†è¿è¡Œåœ¨ `http://localhost:5173`

---

## ğŸ“¦ Docker éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

### âš ï¸ Docker èµ„æºæ¶ˆè€—è¯„ä¼°

**ä¸ä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰ï¼š**
- å†…å­˜å ç”¨: ~200MB (Node.js + SQLite)
- CPU: æœ€å°
- ç£ç›˜: ~100MB

**ä½¿ç”¨ Dockerï¼š**
- å†…å­˜å ç”¨: ~500MB (åŒ…å«å®¹å™¨å¼€é”€)
- CPU: è½»å¾®å¢åŠ 
- ç£ç›˜: ~500MB (åŒ…å«é•œåƒ)

**ç»“è®ºï¼šå¦‚æœæœåŠ¡å™¨èµ„æºç´§ç¼ºï¼Œå»ºè®®ç›´æ¥è¿è¡Œ Node.jsï¼Œä¸ä½¿ç”¨ Dockerã€‚**

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

å¤åˆ¶ `backend/.env.example` åˆ° `backend/.env` å¹¶é…ç½®ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
PORT=8787
NODE_ENV=production

# JWT é…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this

# Stripe é…ç½®ï¼ˆå¯é€‰ï¼‰
STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_publishable_key

# USDT é…ç½®ï¼ˆå¯é€‰ï¼‰
USDT_WALLET_ADDRESS=your_usdt_wallet_address

# CORS é…ç½®
CORS_ORIGIN=https://your-domain.com
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
Shop/
â”œâ”€â”€ virtual-goods-store/          # å‰ç«¯ï¼ˆReact + TypeScriptï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/          # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ contexts/            # Context (Auth, Cart)
â”‚   â”‚   â”œâ”€â”€ pages/               # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts          # âœ… æ–°çš„ API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ supabase.ts     # âŒ å·²åºŸå¼ƒ
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                      # âœ… æ–°å»ºçš„ç‹¬ç«‹åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.sql      # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”‚   â”‚   â”œâ”€â”€ init.js         # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ db.js           # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js         # è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ products.js     # å•†å“è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ categories.js   # åˆ†ç±»è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ cart.js         # è´­ç‰©è½¦è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ orders.js       # è®¢å•è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ payments.js     # æ”¯ä»˜è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â””â”€â”€ auth.js         # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ server.js           # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ data/                    # æ•°æ®åº“æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ uploads/                 # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ cloudflare-migration/         # âŒ å·²åºŸå¼ƒï¼ˆä¿ç•™ä½œä¸ºå‚è€ƒï¼‰
```

---

## ğŸ” API ç«¯ç‚¹

### è®¤è¯
- `POST /api/auth/register` - æ³¨å†Œ
- `POST /api/auth/login` - ç™»å½•
- `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·
- `POST /api/auth/logout` - ç™»å‡º

### å•†å“
- `GET /api/products` - è·å–å•†å“åˆ—è¡¨
- `GET /api/products/slug/:slug` - æ ¹æ® slug è·å–å•†å“
- `GET /api/products/:id` - æ ¹æ® ID è·å–å•†å“

### åˆ†ç±»
- `GET /api/categories` - è·å–åˆ†ç±»åˆ—è¡¨

### è´­ç‰©è½¦
- `GET /api/cart` - è·å–è´­ç‰©è½¦
- `POST /api/cart/add` - æ·»åŠ åˆ°è´­ç‰©è½¦
- `PUT /api/cart/:id` - æ›´æ–°è´­ç‰©è½¦é¡¹
- `DELETE /api/cart/:id` - åˆ é™¤è´­ç‰©è½¦é¡¹

### è®¢å•
- `POST /api/orders` - åˆ›å»ºè®¢å•
- `POST /api/orders/query` - æŸ¥è¯¢è®¢å•ï¼ˆæ¸¸å®¢ï¼‰
- `GET /api/orders/my-orders` - è·å–æˆ‘çš„è®¢å•
- `GET /api/orders/:id` - è·å–è®¢å•è¯¦æƒ…

### æ”¯ä»˜
- `POST /api/payments/stripe/create-payment-intent` - åˆ›å»º Stripe æ”¯ä»˜
- `POST /api/payments/usdt/create-payment` - åˆ›å»º USDT æ”¯ä»˜
- `GET /api/payments/:id/status` - æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€

---

## ğŸ“ ä¸‹ä¸€æ­¥å·¥ä½œ

### 1. å®Œæˆå‰ç«¯è¿ç§»ï¼ˆéœ€è¦ç»§ç»­ï¼‰
- [ ] ä¿®æ”¹ `CartContext.tsx` ä½¿ç”¨æ–° API
- [ ] ä¿®æ”¹æ‰€æœ‰é¡µé¢ç»„ä»¶ä½¿ç”¨æ–° API
- [ ] åˆ é™¤ `@supabase/supabase-js` ä¾èµ–

### 2. æµ‹è¯•
- [ ] æµ‹è¯•ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [ ] æµ‹è¯•å•†å“æµè§ˆ
- [ ] æµ‹è¯•è´­ç‰©è½¦åŠŸèƒ½
- [ ] æµ‹è¯•è®¢å•åˆ›å»º
- [ ] æµ‹è¯•æ”¯ä»˜åŠŸèƒ½

### 3. ç”Ÿäº§éƒ¨ç½²
- [ ] é…ç½® Nginx åå‘ä»£ç†
- [ ] é…ç½® SSL è¯ä¹¦
- [ ] é…ç½®è¿›ç¨‹ç®¡ç†å™¨ (PM2)
- [ ] é…ç½®è‡ªåŠ¨å¤‡ä»½

---

## ğŸ¯ å½“å‰çŠ¶æ€

âœ… åç«¯ API å·²å®Œæˆ
âœ… å‰ç«¯ API å®¢æˆ·ç«¯å·²åˆ›å»º
âœ… AuthContext å·²è¿ç§»
â³ CartContext éœ€è¦è¿ç§»
â³ é¡µé¢ç»„ä»¶éœ€è¦è¿ç§»

---

**è¯·å…ˆæœ¬åœ°æµ‹è¯•ï¼Œç¡®è®¤æ— è¯¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨ï¼**

